{% extends 'base.html' %}
{% block title %}Chatbot{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 style="color: rgb(52, 51, 51);">drama llama</h2>
    <div class="radio-group">
    
        <input type="radio" class="radio-input" name="options" id="option1" autocomplete="off">
        <label class="radio-label" for="option2">
            <a href="/chatbot" class="radio-link">Haiku</a>
        </label>
    
    
        <input type="radio" class="radio-input" name="options" id="option2" autocomplete="off">
        <label class="radio-label" for="option4">
            <a href="chatbot1.2" class="radio-link">Free verse</a>
        </label>

        <input type="radio" class="radio-input" name="options" id="option2" autocomplete="off">
        <label class="radio-label" for="option4">
            <a href="chatbot1.3" class="radio-link">Sonnet</a>
        </label>

        <input type="radio" class="radio-input" name="options" id="option2" autocomplete="off">
        <label class="radio-label" for="option4">
            <a href="chatbot1.4" class="radio-link">Acrostic</a>
        </label>
    </div>
    
    <div id="chatbox" class="border p-3" style="height: 800px; overflow-y: scroll; background-color: rgba(255, 255, 255, 0.447);">
        <ul id="messages" class="list-unstyled">
            <!-- Chat messages will be appended here dynamically -->
        </ul>
    </div>
    <form id="chat-form" method="post">
        <div class="input-group mt-3">
            <input type="text" id="message-input" name="message" class="form-control" placeholder="Type your message..." autocomplete="off" style="font-size: 1em;">
            <button type="submit" class="btn btn-primary">Send</button>
        </div>
    </form>
</div>
<br/>
<br/>
<br/>
<br/>

<style>
    /* Styling for radio buttons */ 
    .radio-group {
        display: flex;
        gap: 10px; /* Space between buttons */
    }

    .radio-input {
        display: none; /* Hide the default radio button */
    }

    .radio-label {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.3s ease;
    }

    .radio-label:hover {
        background-color: #0056b3;
    }


    .radio-link {
        color: white;
        text-decoration: none;
        display: block;
    }

    .radio-link:hover {
        text-decoration: underline;
    }
    /* Style for bot messages */
    .bot-message {
        font-size: 1em; /* Font size for bot messages */
        color: #333; /* Optional: Change the color for bot messages */
        line-height: 1.6; /* Spacing between lines in the message */
        margin-bottom: 15px; /* Space after each message */
        background-color: #f0f0f0; /* White bubble */
        padding: 10px;
        border-radius: 10px;
        display: inline-block;
        max-width: 70%;
    }
    
    /* Style for user messages */
    .user-message {
        font-size: 1em; /* Font size for user messages */
        color: #ffffff; /* Optional: Change the color for user messages */
        line-height: 1.6; /* Spacing between lines in the message */
        margin-bottom: 15px; /* Space after each message */
        background-color: #007bff; /* Blue bubble */
        padding: 10px;
        border-radius: 10px;
        display: inline-block;
        max-width: 70%;
        align-self: flex-end; /* Aligns the user message to the right */
    }

    /* Ensure that each message appears in order */
    #messages {
        display: flex;
        flex-direction: column;
        gap: 10px; /* Adds space between messages */
    }

    /* Align user messages to the right */
    #messages .user-message {
        align-self: flex-end;
    }

    /* Align bot messages to the left */
    #messages .bot-message {
        align-self: flex-start;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('chat-form');
        const input = document.getElementById('message-input');
        const messages = document.getElementById('messages');
        const chatbox = document.getElementById('chatbox');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const userMessage = input.value;
            
            if (userMessage.trim() === '') return;

            // Display user's message with the 'user-message' class
            const userMessageElement = document.createElement('li');
            userMessageElement.textContent = 'You: ' + userMessage;
            userMessageElement.classList.add('user-message');
            messages.appendChild(userMessageElement);

            // Scroll to the bottom of the chatbox
            chatbox.scrollTop = chatbox.scrollHeight;

            fetch('/chatbot1.3', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'message': userMessage
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json(); // Try to parse the response as JSON
            })
            .then(data => {
                // Display bot's message with the 'bot-message' class
                const botMessageElement = document.createElement('li');
                botMessageElement.innerHTML = 'llama:</br > ' + data.response.replace(/\n/g, '</br>'); //turn this into html <---------
                botMessageElement.classList.add('bot-message');
                messages.appendChild(botMessageElement);
            
                chatbox.scrollTop = chatbox.scrollHeight;
            })
            .catch(error => {
                console.error('Error:', error);
                const errorMessageElement = document.createElement('li');
                errorMessageElement.textContent = 'Error: ' + error.message;
                messages.appendChild(errorMessageElement);
            });

            // Clear the input field after submission
            input.value = '';
        });
    });
</script>
{% endblock %}